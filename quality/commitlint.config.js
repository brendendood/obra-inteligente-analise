// üí¨ Commitlint Configuration - Git Commit Message Quality
// Configura√ß√£o para verifica√ß√£o de mensagens de commit sem altera√ß√µes

module.exports = {
  // ===================================================================
  // üìù CONFIGURA√á√ÉO BASE
  // ===================================================================
  
  // Usar configura√ß√£o convencional padr√£o
  extends: ['@commitlint/config-conventional'],
  
  // Parser para mensagens de commit
  parserPreset: 'conventional-changelog-conventionalcommits',
  
  // ===================================================================
  // üéØ REGRAS CUSTOMIZADAS
  // ===================================================================
  
  rules: {
    // ===============================
    // üìè REGRAS DE FORMATO
    // ===============================
    
    // Corpo da mensagem
    'body-case': [0], // Desabilitado - permite qualquer case
    'body-empty': [0], // Desabilitado - corpo opcional
    'body-leading-blank': [2, 'always'], // Linha em branco antes do corpo
    'body-max-length': [2, 'always', 500], // M√°ximo 500 caracteres no corpo
    'body-max-line-length': [2, 'always', 100], // M√°ximo 100 caracteres por linha
    'body-min-length': [0], // Desabilitado - sem m√≠nimo
    
    // Footer da mensagem
    'footer-empty': [0], // Footer opcional
    'footer-leading-blank': [2, 'always'], // Linha em branco antes do footer
    'footer-max-length': [2, 'always', 100], // M√°ximo 100 caracteres no footer
    'footer-max-line-length': [2, 'always', 100], // M√°ximo 100 caracteres por linha
    'footer-min-length': [0], // Sem m√≠nimo
    
    // Header (primeira linha)
    'header-case': [0], // Permite qualquer case no header
    'header-full-stop': [2, 'never', '.'], // N√£o terminar com ponto
    'header-max-length': [2, 'always', 100], // M√°ximo 100 caracteres
    'header-min-length': [2, 'always', 10], // M√≠nimo 10 caracteres
    
    // ===============================
    // üè∑Ô∏è REGRAS DE TIPO
    // ===============================
    
    // Tipo do commit (obrigat√≥rio)
    'type-case': [2, 'always', 'lower-case'], // Sempre min√∫sculo
    'type-empty': [2, 'never'], // N√£o pode estar vazio
    'type-enum': [
      2,
      'always',
      [
        // Tipos padr√£o
        'feat', // Nova funcionalidade
        'fix', // Corre√ß√£o de bug
        'docs', // Documenta√ß√£o
        'style', // Formata√ß√£o, espa√ßos em branco, etc.
        'refactor', // Refatora√ß√£o de c√≥digo
        'perf', // Melhoria de performance
        'test', // Adi√ß√£o ou corre√ß√£o de testes
        'chore', // Tarefas de manuten√ß√£o
        'ci', // Mudan√ßas em CI/CD
        'build', // Mudan√ßas no sistema de build
        'revert', // Reverter commit anterior
        
        // Tipos espec√≠ficos do projeto
        'quality', // Melhorias de qualidade de c√≥digo
        'security', // Corre√ß√µes de seguran√ßa
        'a11y', // Melhorias de acessibilidade
        'i18n', // Internacionaliza√ß√£o
        'config', // Mudan√ßas de configura√ß√£o
        'deps', // Atualiza√ß√£o de depend√™ncias
        'release', // Release/versioning
      ],
    ],
    
    // ===============================
    // üéØ REGRAS DE ESCOPO
    // ===============================
    
    // Escopo do commit (opcional)
    'scope-case': [2, 'always', 'lower-case'], // Sempre min√∫sculo
    'scope-empty': [0], // Escopo √© opcional
    'scope-enum': [
      1, // Warning apenas
      'always',
      [
        // Escopos por √°rea
        'auth', // Autentica√ß√£o
        'dashboard', // Dashboard
        'projects', // Gest√£o de projetos
        'upload', // Upload de arquivos
        'ai', // Sistema de IA
        'crm', // CRM
        'admin', // Painel administrativo
        'budget', // Or√ßamento
        'schedule', // Cronograma
        'docs', // Documentos
        
        // Escopos t√©cnicos
        'ui', // Componentes UI
        'api', // Integra√ß√µes de API
        'db', // Database/Supabase
        'config', // Configura√ß√µes
        'build', // Build system
        'deps', // Depend√™ncias
        'types', // TypeScript types
        'tests', // Testes
        'quality', // Qualidade de c√≥digo
        
        // Escopos de arquitetura
        'core', // Funcionalidades core
        'utils', // Utilit√°rios
        'hooks', // Custom hooks
        'stores', // Estado global
        'contexts', // React contexts
        'components', // Componentes
        'pages', // P√°ginas
        'layouts', // Layouts
        'assets', // Assets est√°ticos
      ],
    ],
    
    // ===============================
    // üìù REGRAS DE DESCRI√á√ÉO
    // ===============================
    
    // Descri√ß√£o do commit (obrigat√≥ria)
    'subject-case': [0], // Permite qualquer case
    'subject-empty': [2, 'never'], // N√£o pode estar vazio
    'subject-full-stop': [2, 'never', '.'], // N√£o terminar com ponto
    'subject-max-length': [2, 'always', 100], // M√°ximo 100 caracteres
    'subject-min-length': [2, 'always', 5], // M√≠nimo 5 caracteres
    
    // ===============================
    // üîó REGRAS DE REFER√äNCIAS
    // ===============================
    
    // Refer√™ncias (issues, PRs, etc.)
    'references-empty': [0], // Refer√™ncias opcionais
    
    // Breaking changes
    'body-max-line-length': [0], // Desabilitado para permitir URLs longas
    'footer-max-line-length': [0], // Desabilitado para permitir URLs longas
  },
  
  // ===================================================================
  // üîß CONFIGURA√á√ïES AVAN√áADAS
  // ===================================================================
  
  // Configura√ß√µes do parser
  parserOpts: {
    // Header pattern personalizado
    headerPattern: /^(\w*)(?:\(([^)]*)\))?: (.*)$/,
    headerCorrespondence: ['type', 'scope', 'subject'],
    
    // Refer√™ncias (issues, PRs)
    referenceActions: [
      'close',
      'closes',
      'closed',
      'fix',
      'fixes',
      'fixed',
      'resolve',
      'resolves',
      'resolved',
      'refs',
      'references',
    ],
    
    // Issues keywords
    issuePrefixes: ['#', 'gh-'],
    
    // Breaking change keywords
    noteKeywords: ['BREAKING CHANGE', 'BREAKING CHANGES'],
    
    // Field pattern
    fieldPattern: /^-(.*?)-$/,
    
    // Revert pattern
    revertPattern: /^(?:Revert|revert:)\s"?([\s\S]+?)"?\s*This reverts commit (\w*)\./i,
    revertCorrespondence: ['header', 'hash'],
  },
  
  // ===================================================================
  // üéØ CONFIGURA√á√ïES ESPEC√çFICAS DO PROJETO
  // ===================================================================
  
  // Configura√ß√µes customizadas para MadenAI
  _qualityConfig: {
    // Tipos mais usados no projeto
    preferredTypes: [
      'feat', // Novas funcionalidades
      'fix', // Corre√ß√µes
      'docs', // Documenta√ß√£o
      'refactor', // Refatora√ß√£o
      'quality', // Melhorias de qualidade
    ],
    
    // Escopos cr√≠ticos
    criticalScopes: [
      'auth', // Sistema de autentica√ß√£o
      'projects', // Core business logic
      'ai', // Sistema de IA
      'db', // Database changes
      'security', // Seguran√ßa
    ],
    
    // Padr√µes recomendados
    patterns: {
      // Feature
      feature: 'feat(scope): add new functionality description',
      
      // Bug fix
      bugfix: 'fix(scope): resolve issue with specific problem',
      
      // Documentation
      documentation: 'docs(scope): update documentation for feature',
      
      // Refactor
      refactor: 'refactor(scope): improve code structure without changing behavior',
      
      // Quality improvement
      quality: 'quality(scope): improve code quality and maintainability',
      
      // Configuration
      config: 'config(scope): update configuration for environment',
      
      // Dependencies
      dependencies: 'deps: update package-name to version x.y.z',
      
      // Breaking change
      breaking: 'feat(scope)!: add breaking change\n\nBREAKING CHANGE: description',
    },
    
    // M√©tricas para tracking
    metrics: [
      'total-commits',
      'commits-by-type',
      'commits-by-scope',
      'average-message-length',
      'breaking-changes-count',
      'invalid-commits-count',
    ],
    
    // Quality gates
    gates: {
      maxInvalidCommits: 0, // Todos os commits devem ser v√°lidos
      minAverageMessageLength: 20, // Mensagens devem ser descritivas
      maxMessageLength: 100, // Evitar mensagens muito longas
    },
  },
  
  // ===================================================================
  // üîç VALIDA√á√ÉO CUSTOMIZADA
  // ===================================================================
  
  // Plugins customizados (se necess√°rio)
  plugins: [
    // Plugin para validar refer√™ncias de issues
    {
      rules: {
        'issue-reference': (parsed) => {
          // Valida√ß√£o customizada para refer√™ncias de issues
          if (parsed.type === 'fix' && !parsed.body?.includes('#')) {
            return [false, 'Fix commits should reference an issue'];
          }
          return [true];
        },
      },
    },
  ],
  
  // Fun√ß√£o de valida√ß√£o customizada
  formatter: '@commitlint/format',
  
  // Configura√ß√µes de prompt (se usar com commitizen)
  prompt: {
    settings: {},
    messages: {
      type: 'Selecione o tipo de mudan√ßa que voc√™ est√° commitando:',
      scope: 'Qual √© o escopo desta mudan√ßa (opcional):',
      subject: 'Escreva uma descri√ß√£o CURTA e IMPERATIVA da mudan√ßa:\n',
      body: 'Forne√ßa uma descri√ß√£o MAIS LONGA da mudan√ßa (opcional). Use "|" para quebrar nova linha:\n',
      breaking: 'Liste qualquer BREAKING CHANGE (opcional):\n',
      footer: 'Liste qualquer ISSUE FECHADA por esta mudan√ßa (opcional). Ex.: #31, #34:\n',
      confirmCommit: 'Voc√™ tem certeza de que deseja prosseguir com o commit acima?',
    },
  },
};

// ===================================================================
// üìã INSTRU√á√ïES DE USO
// ===================================================================
/*

üîç VERIFICAR √öLTIMO COMMIT:
npm run quality:commit

üí¨ VERIFICAR COMMIT ESPEC√çFICO:
npx commitlint --from HEAD~1 --to HEAD

üìù VERIFICAR MENSAGEM:
echo "feat: add new feature" | npx commitlint

üéØ EXEMPLOS DE COMMITS V√ÅLIDOS:

‚úÖ FUNCIONALIDADES:
feat: add user authentication system
feat(auth): implement two-factor authentication
feat(dashboard): add project overview widgets

‚úÖ CORRE√á√ïES:
fix: resolve login redirect issue
fix(api): handle null response from supabase
fix(ui): correct button alignment on mobile

‚úÖ DOCUMENTA√á√ÉO:
docs: update setup instructions
docs(api): add authentication examples
docs(quality): create quality check guide

‚úÖ REFATORA√á√ÉO:
refactor: simplify user validation logic
refactor(auth): extract common validation functions
refactor(stores): consolidate project state management

‚úÖ QUALIDADE:
quality: add ESLint rules for TypeScript
quality(deps): update and audit dependencies
quality(tests): add smoke tests for core features

‚ùå EXEMPLOS INV√ÅLIDOS:
- "Update code" (muito vago)
- "fix bug" (n√£o espec√≠fico)
- "Add feature." (termina com ponto)
- "FEAT: add feature" (tipo em mai√∫scula)
- "" (vazio)

üéØ TIPOS PRINCIPAIS:
- feat: Nova funcionalidade
- fix: Corre√ß√£o de bug
- docs: Documenta√ß√£o
- refactor: Refatora√ß√£o
- quality: Melhoria de qualidade
- chore: Tarefas de manuten√ß√£o

üìã ESCOPOS COMUNS:
- auth, dashboard, projects, ai, crm
- ui, api, db, config, deps
- tests, quality, security

*/