# üìã SNAPSHOT API CONTRACTS - 25/08/2025

> **Data:** 2025-08-25  
> **Modo:** SAFE MODE - Documenta√ß√£o de contratos existentes  
> **Tipo:** Frontend SPA + Integra√ß√µes Externas

## üåê FRONTEND ROUTES (Client-side SPA)

### üì± **Rotas P√∫blicas**
```yaml
GET /:
  description: Landing page principal
  response: 200 (HTML)
  authentication: false
  component: LandingPage

GET /login:
  description: P√°gina de login
  response: 200 (HTML)
  authentication: false
  component: Login

GET /cadastro:
  description: P√°gina de cadastro
  response: 200 (HTML)
  authentication: false
  component: Signup

GET /reset-password:
  description: Reset de senha
  response: 200 (HTML)
  authentication: false
  component: ResetPassword

GET /auth/callback:
  description: Callback OAuth Supabase
  response: 200 (HTML) | 302 (redirect)
  authentication: false
  component: ConfirmAccount

GET /confirm-email:
  description: Confirma√ß√£o de email
  response: 200 (HTML)
  authentication: false
  component: ConfirmEmail

GET /termos:
  description: Termos de uso
  response: 200 (HTML)
  authentication: false
  component: Terms

GET /politica:
  description: Pol√≠tica de privacidade
  response: 200 (HTML)
  authentication: false
  component: Privacy
```

### üîê **Rotas Protegidas**
```yaml
GET /painel:
  description: Dashboard principal
  response: 200 (HTML) | 401 (redirect to login)
  authentication: required
  component: Dashboard

GET /upload:
  description: Upload de arquivos
  response: 200 (HTML) | 401 (redirect to login)
  authentication: required
  component: Upload

GET /ia:
  description: IA geral
  response: 200 (HTML) | 401 (redirect to login)
  authentication: required
  component: AIGeneral

GET /conta:
  description: Configura√ß√µes da conta
  response: 200 (HTML) | 401 (redirect to login)
  authentication: required
  component: Account

GET /crm:
  description: Dashboard CRM
  response: 200 (HTML) | 401 (redirect to login)
  authentication: required
  component: CRMPage

GET /admin-panel:
  description: Painel administrativo
  response: 200 (HTML) | 401 (redirect to login) | 403 (forbidden)
  authentication: required
  authorization: admin_role
  component: AdminPage
```

### üéØ **Rotas de Projeto**
```yaml
GET /projeto/:projectId:
  description: Overview do projeto
  parameters:
    - name: projectId
      type: string
      required: true
      format: uuid
  response: 200 (HTML) | 401 (redirect) | 404 (not found)
  authentication: required
  component: ProjectSpecificOverview

GET /projeto/:projectId/orcamento:
  description: Or√ßamento do projeto
  parameters:
    - name: projectId
      type: string
      required: true
      format: uuid
  response: 200 (HTML) | 401 (redirect) | 404 (not found)
  authentication: required
  component: ProjectSpecificBudget

GET /projeto/:projectId/cronograma:
  description: Cronograma do projeto
  parameters:
    - name: projectId
      type: string
      required: true
      format: uuid
  response: 200 (HTML) | 401 (redirect) | 404 (not found)
  authentication: required
  component: ProjectSpecificSchedule

GET /projeto/:projectId/assistente:
  description: Assistente IA do projeto
  parameters:
    - name: projectId
      type: string
      required: true
      format: uuid
  response: 200 (HTML) | 401 (redirect) | 404 (not found)
  authentication: required
  component: ProjectSpecificAssistant

GET /projeto/:projectId/documentos:
  description: Documentos do projeto
  parameters:
    - name: projectId
      type: string
      required: true
      format: uuid
  response: 200 (HTML) | 401 (redirect) | 404 (not found)
  authentication: required
  component: ProjectSpecificDocumentsPage
```

### üö´ **Fallback Route**
```yaml
GET /*:
  description: P√°gina 404 para rotas n√£o encontradas
  response: 404 (HTML)
  authentication: false
  component: NotFound
```

## üîå EXTERNAL API INTEGRATIONS

### üóÑÔ∏è **Supabase APIs**
```yaml
base_url: https://mozqijzvtbuwuzgemzsm.supabase.co
authentication: Bearer JWT / API Key

Auth API:
  POST /auth/v1/signup:
    description: Cadastro de usu√°rio
    payload: { email, password, options }
    response: 200 | 400 | 422

  POST /auth/v1/token:
    description: Login
    payload: { email, password, grant_type }
    response: 200 | 400 | 401

  POST /auth/v1/logout:
    description: Logout
    response: 204

Database API:
  GET /rest/v1/projects:
    description: Listar projetos
    headers: { Authorization, apikey }
    response: 200 | 401 | 403

  POST /rest/v1/projects:
    description: Criar projeto
    payload: { name, type, area, location, user_id }
    response: 201 | 400 | 401 | 403

  PATCH /rest/v1/projects:
    description: Atualizar projeto
    payload: { partial project data }
    response: 200 | 400 | 401 | 403 | 404

Storage API:
  POST /storage/v1/object/uploads:
    description: Upload de arquivo
    payload: multipart/form-data
    response: 200 | 400 | 401 | 403 | 413

Realtime API:
  WebSocket wss://mozqijzvtbuwuzgemzsm.supabase.co/realtime/v1/websocket:
    description: Subscriptions em tempo real
    authentication: JWT token
    channels: [projects, auth changes]
```

### ü§ñ **N8N AI Webhooks**
```yaml
base_url: https://madeai-br.app.n8n.cloud/webhook

POST /chat-geral:
  description: Chat geral IA
  timeout: 30s
  retries: 2
  payload:
    message: string
    agent_type: "general"
    user_context: object
    timestamp: string
  response: 200 | 408 | 500

POST /projeto-chat:
  description: Chat espec√≠fico do projeto
  timeout: 30s
  retries: 2
  payload:
    message: string
    agent_type: "project"
    project_context: object
    user_context: object
    timestamp: string
  response: 200 | 408 | 500

POST /orcamento-ia:
  description: IA para or√ßamento
  timeout: 45s
  retries: 1
  payload:
    message: string
    agent_type: "budget"
    project_context: object
    technical_context: object
    timestamp: string
  response: 200 | 408 | 500

POST /cronograma-ia:
  description: IA para cronograma
  timeout: 45s
  retries: 1
  payload:
    message: string
    agent_type: "schedule"
    project_context: object
    technical_context: object
    timestamp: string
  response: 200 | 408 | 500

POST /analise-tecnica:
  description: An√°lise t√©cnica IA
  timeout: 60s
  retries: 1
  payload:
    message: string
    agent_type: "analysis"
    project_context: object
    technical_context: object
    timestamp: string
  response: 200 | 408 | 500
```

### üåê **External Services**
```yaml
IP Geolocation:
  GET https://api.ipify.org?format=json:
    description: Obter IP p√∫blico
    response: { ip: string }

Email Services (via Supabase Edge Functions):
  POST /functions/v1/email-service:
    description: Envio de emails
    authentication: JWT
    payload: { to, subject, body, template }
    response: 200 | 400 | 401 | 500
```

## üìä DATA CONTRACTS

### üóÑÔ∏è **Database Schema (Principais Tabelas)**
```yaml
projects:
  id: uuid (PK)
  user_id: uuid (FK)
  name: string
  type: string
  area: numeric
  location: string
  status: string
  created_at: timestamp
  updated_at: timestamp

profiles:
  id: uuid (PK)
  user_id: uuid (FK)
  display_name: string
  avatar_url: string
  plan: string
  created_at: timestamp

user_sessions:
  id: uuid (PK)
  user_id: uuid (FK)
  ip_address: string
  user_agent: string
  login_timestamp: timestamp
  location_data: jsonb
```

### üìù **TypeScript Contracts**
```typescript
// Agent System
interface AgentRequest {
  message: string;
  agent_type: 'general' | 'project' | 'budget' | 'schedule' | 'analysis';
  user_context?: UserContext;
  project_context?: ProjectContext;
  technical_context?: TechnicalContext;
  timestamp: string;
}

interface AgentResponse {
  response: string;
  metadata?: Record<string, any>;
  actions?: string[];
}

// Project Data
interface Project {
  id: string;
  user_id: string;
  name: string;
  type?: string;
  area?: number;
  location?: string;
  status: string;
  created_at: string;
  updated_at: string;
}

// Auth Context
interface AuthUser {
  id: string;
  email: string;
  user_metadata: {
    display_name?: string;
    avatar_url?: string;
  };
}
```

## üîí AUTHENTICATION & AUTHORIZATION

### üé´ **Authentication Flow**
```yaml
Public Routes:
  - No authentication required
  - Direct access allowed

Protected Routes:
  - JWT token required
  - Automatic redirect to /login if not authenticated
  - Token validation via Supabase

Admin Routes:
  - JWT token + admin role required
  - 403 Forbidden if not admin
  - Impersonation capabilities for admin users
```

### üõ°Ô∏è **Authorization Levels**
```yaml
Anonymous: [/, /login, /cadastro, /termos, /politica]
Authenticated: [/painel, /upload, /ia, /conta, /crm, /projeto/*]
Admin: [/admin-panel, /admin/*]
```

---

## üìã **RESUMO DO SNAPSHOT**

### ‚úÖ **Contratos Identificados**
- **25 rotas frontend** documentadas
- **15+ endpoints Supabase** mapeados
- **5 webhooks N8N** especificados
- **Schemas de dados** principais definidos
- **Fluxos de auth** documentados

### üîó **Integra√ß√µes Externas**
- **Supabase** (Auth, DB, Storage, Realtime)
- **N8N** (AI Webhooks)
- **IP Geolocation** (External API)
- **Email Services** (Edge Functions)

### üéØ **Pr√≥ximos Passos**
1. Implementar smoke tests baseados nestes contratos
2. Monitorar breaking changes em integra√ß√µes
3. Validar responses dos endpoints externos
4. Documentar mudan√ßas em futuras vers√µes

---

> **üìã CONCLUS√ÉO:** Sistema SPA com contratos bem definidos para integra√ß√µes externas. Arquitetura baseada em servi√ßos externos (Supabase + N8N) com routing client-side robusto.