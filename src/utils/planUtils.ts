
// Utilit√°rios centralizados para planos de usu√°rio

export type PlanType = 'basic' | 'pro' | 'enterprise';

export interface PlanInfo {
  name: string;
  displayName: string;
  price: number;
  projectLimit: number;
  messageLimit: number;
  userLimit: number;
  icon: string;
  color: string;
  badgeStyle: string;
  features: string[];
}

export const PLANS: Record<PlanType, PlanInfo> = {
  basic: {
    name: 'basic',
    displayName: 'Basic',
    price: 29.90,
    projectLimit: 5,
    messageLimit: 500,
    userLimit: 1,
    icon: 'üìã',
    color: '#059669',
    badgeStyle: 'bg-green-600 text-white border-green-600',
    features: [
      'An√°lise Geral de projetos (normas ABNT)',
      'Uso individual (1 usu√°rio)',
      'At√© 5 projetos ativos (fixo, n√£o renov√°vel)',
      '500 mensagens de IA/m√™s',
      'Cronograma e or√ßamento b√°sicos',
      'Exporta√ß√£o simples em PDF',
      '1 automa√ß√£o via webhook',
      'Suporte em at√© 48h'
    ]
  },
  pro: {
    name: 'pro',
    displayName: 'Pro',
    price: 79.90,
    projectLimit: 20,
    messageLimit: 2000,
    userLimit: 3,
    icon: '‚≠ê',
    color: '#2563EB',
    badgeStyle: 'bg-blue-600 text-white border-blue-600',
    features: [
      'Tudo do Basic +',
      'At√© 3 usu√°rios inclusos',
      'At√© 20 projetos ativos (fixo, n√£o renov√°vel)',
      '2.000 mensagens de IA/m√™s',
      'Cronograma, or√ßamento e documentos avan√ßados',
      'Controle de permiss√µes por papel (admin e colaborador)',
      'At√© 5 automa√ß√µes integradas (Zapier, n8n etc.)',
      'Exporta√ß√µes avan√ßadas (cronogramas detalhados, relat√≥rios completos)',
      'Suporte priorit√°rio (<24h)'
    ]
  },
  enterprise: {
    name: 'enterprise',
    displayName: 'Enterprise',
    price: 199.90,
    projectLimit: -1, // ilimitado
    messageLimit: -1, // ilimitado
    userLimit: 10,
    icon: 'üëë',
    color: '#8B5CF6',
    badgeStyle: 'bg-gradient-to-r from-purple-500 to-purple-600 text-white border-purple-600',
    features: [
      'Tudo do Pro +',
      'At√© 10 usu√°rios inclusos',
      'Projetos ilimitados',
      'Mensagens de IA ilimitadas',
      '50 GB para anexos de projetos',
      'Auditoria t√©cnica e relat√≥rios completos',
      'Hist√≥rico completo de projetos e exporta√ß√µes avan√ßadas',
      'Suporte dedicado com gerente de conta',
      'Onboarding e treinamento personalizados',
      'Contrato customizado para empresas',
      'Integra√ß√µes avan√ßadas com ERPs (em breve)'
    ]
  }
};

export const getPlanInfo = (plan: string | PlanType): PlanInfo => {
  return PLANS[plan as PlanType] || PLANS.basic;
};

export const getPlanDisplayName = (plan: string | PlanType): string => {
  return getPlanInfo(plan).displayName;
};

export const getPlanIcon = (plan: string | PlanType): string => {
  return getPlanInfo(plan).icon;
};

export const getPlanColor = (plan: string | PlanType): string => {
  return getPlanInfo(plan).color;
};

export const getPlanBadgeStyle = (plan: string | PlanType): string => {
  return getPlanInfo(plan).badgeStyle;
};

export const getPlanPrice = (plan: string | PlanType): number => {
  return getPlanInfo(plan).price;
};

export const getPlanLimit = (plan: string | PlanType, extraCredits: number = 0): number => {
  const planInfo = getPlanInfo(plan);
  if (plan === 'enterprise') {
    return 999999; // Ilimitado para enterprise
  }
  // Retorna o limite total (base + projetos extras)
  return planInfo.projectLimit + extraCredits;
};

export const getPlanFeatures = (plan: string | PlanType): string[] => {
  return getPlanInfo(plan).features;
};

export const getPlanLimitations = (plan: string | PlanType): string[] => {
  return [];
};

export const getNextPlan = (currentPlan: string | PlanType): PlanType | null => {
  switch (currentPlan) {
    case 'basic': return 'pro';
    case 'pro': return 'enterprise';
    case 'enterprise': return null; // J√° √© o plano m√°ximo
    default: return 'basic';
  }
};

export const isMaxPlan = (plan: string | PlanType): boolean => {
  return plan === 'enterprise';
};

export const canUpgrade = (plan: string | PlanType): boolean => {
  return !isMaxPlan(plan);
};

export const getUpgradeMessage = (currentPlan: string | PlanType): string => {
  const nextPlan = getNextPlan(currentPlan);
  if (!nextPlan) return 'Voc√™ j√° est√° no plano m√°ximo!';
  
  return `Upgrade para ${getPlanDisplayName(nextPlan)}`;
};

export const formatPlanPrice = (plan: string | PlanType): string => {
  const price = getPlanPrice(plan);
  return `R$ ${price}/m√™s`;
};

export const getPlanUsagePercentage = (projectCount: number, plan: string | PlanType, extraCredits: number = 0): number => {
  const limit = getPlanLimit(plan, extraCredits);
  if (limit === 999) return 0; // Enterprise = ilimitado
  return Math.min((projectCount / limit) * 100, 100);
};

export const shouldShowUpgradeWarning = (projectCount: number, plan: string | PlanType, extraCredits: number = 0): boolean => {
  const percentage = getPlanUsagePercentage(projectCount, plan, extraCredits);
  return percentage >= 80 && canUpgrade(plan);
};
